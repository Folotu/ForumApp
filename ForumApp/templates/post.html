{% extends "base.html" %}

{% block title %} {{ post.title }}{% endblock %}

<h1>{% block header %}{% endblock %}</h1>

{% block body %}

<!-- Define the function that will handle the recursion -->

<div class="col-md-auto col-lg-auto col-sm-auto w-100">
    <h1>{{ post.title }}</h1>

    <h5>{{ post.description }} </h5>
    <small class="card-foot"> Posted by {{ post.author.username }} </small>


{% macro loop_replies(replies) %}
    {% for reply in replies %}
        <div class="card mb-12 col-md-auto col-lg-auto ">
            <div class="card-body">
                <h5 class="card-title">{{ reply.author.username }}</h5>
                <p class="card-text">{{ reply.reply }}</p>
                {% if reply.replies %}
                    {{ loop_replies(reply.replies) }}
                {% endif %}
            </div>
        </div>
    {% endfor %} 

    <button type="button" id="replyNest-button" class="btn btn-primary">Add Reply</button>
        <div id="NestrepDiv" style="display: none;">
            <form method="POST" action="/comment/{{ comment.id }}/add_reply">
                <textarea id="Nestreply-text" name="reply" rows="5"></textarea>
                
                <input type="text" name="reply_parent_id" value="" style="display: none;"> 
                <button type="submit">Submit Reply</button>
            </form>
        </div>
    

{% endmacro %}

<div class="card-columns" style="column-count: 1;">
    {% for comment in post.Comment %}
        <div class="card mb-12 col-md-auto col-lg-auto ">
            <div class="card-body">
                <h5 class="card-title">{{ comment.author.username }}</h5>
                <p class="card-text">{{ comment.comment }}</p>
                {% for reply in comment.Reply %}
                    <div class="card mb-12 col-md-auto col-lg-auto ">
                        <div class="card-body">
                            <h5 class="card-title">{{ reply.author.username }}</h5>
                            <p class="card-text">{{ reply.reply }}</p>
                            {% if reply.replies %}
                                {{ loop_replies(reply.replies) }}
                            {% endif %}
                        </div>
                    </div>
                {% endfor %} 

                <button type="button" id="reply-button" class="btn btn-primary">Add Reply</button>
                <div id="repDiv" style="display: none;">
                    <form method="POST" action="/comment/{{ comment.id }}/add_reply">
                        <textarea id="reply-text" name="reply" rows="5"></textarea>
                        
                        <input type="text" name="reply_parent_id" value="" style="display: none;"> 
                        <button type="submit">Submit Reply</button>
                    </form>
                
                </div>
            </div>
        </div>
    {% endfor %}     
                <button type="button" id="comment-button" class="btn btn-primary">Add Comment</button>
                    <div id="comDiv" style="display: none;">
                        <form method="POST" action="/post/{{ post.id }}/add_comment">
                            <textarea id="comment-text"  name="comment" rows="5"></textarea>
                    
                            <button type="submit">Submit Comment</button>
                    </form>
                </div>
     </div>
</div>

</div>

{% endblock %}